!function(){"use strict";var t,o;doNothing=function(e){console.debug("Ignored error",e)},reportErr=function(e,t,o){if(200<e.status&&e.responseText)try{var n=JSON.parse(e.responseText);if("Too many accounts"===n.error)return alert("You reached the maximum allowed accounts"),load();n.error&&$("#errmsg").text(n.error)}catch(e){console.error(e),$("#errmsg").text(o)}console.error(e.responseText),console.log(e.status),display("#none")},addDevice=function(){ask("accountName","createAccount").then(function(e){_addDevice(e)}).catch(doNothing)},_addDevice=function(e){return $.ajax({type:"POST",url:o+"add",data:JSON.stringify({token:t,name:e}),contentType:"application/json",dataType:"json",success:function(e){displayPwd(e)},error:reportErr}),!1},ask=function(o,n,i){return new Promise(function(t,e){$("#promptmsg").text(window.translate(o)),$("#promptok").text(window.translate(n||"validate")),$("#promptok").click(function(){var e=$("#promptval").val();if(!i&&!e)return!1;t($("#promptval").val())}),$("#promptcancel").click(function(){load(),e()}),display("#prompt"),i?$("#promptinput").hide():($("#promptinput").show(),$("#promptval").focus())})},copy=function(e){navigator.clipboard.writeText(e),$("#copied").fadeIn(),setTimeout(function(){$("#copied").fadeOut()},700)},displayPwd=function(e){$("#newpwd").html('\n<h6 class="text-xl font-bold text-center mb-8">Courriel: '.concat(e.mail,'</h6>\n<h6 class="text-xl font-bold text-center mb-8">Identifiant: ').concat(e.uid,' <button style="display:inline;" class="cursor-pointer hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 rounded-xl bg-blue-700 h-[48px] w-[48px]"><img src="/static/cnb/img/copy.png" onclick="copy(\'').concat(e.uid,'\')" style="display:inline;" width="25px"/></button></h6>\n<h6 class="text-xl font-bold text-center mb-8">Mot de passe: <span id="escaped"></span> <button style="display:inline;" class="cursor-pointer hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 rounded-xl bg-blue-700 h-[48px] w-[48px]"><img src="/static/cnb/img/copy.png" onclick="copy(\'').concat(e.pwd,'\')" style="display:inline;" width="25px"/></button></h6>\n  ')),$("#escaped").text(e.pwd),display("#displaypwd")},delDevice=function(e){ask("delAppAccount","confirm",1).then(function(){console.debug("Call _device",e),_delDevice(e)}).catch(doNothing)},_delDevice=function(e){return $.ajax({type:"POST",url:o+"del",data:JSON.stringify({token:t,uid:e}),contentType:"application/json",dataType:"json",success:function(e){load()},error:reportErr}),!1},load=function(){$("#newpwd").html(""),display("#displaylist"),$.ajax({url:o+"list",dataType:"json",success:function(e){var o="";e.forEach(function(e){var t=e.uid.replace(/\W/g,"");o+=deviceTemplate(e.name||e.uid,t)}),$("#deviceslist").html(o),e.forEach(function(e){var t=e.uid.replace(/\W/g,"");console.debug("Add remove event on #remove"+e.uid),$("#remove"+t).click(function(){delDevice(e.uid)})})},error:reportErr})},display=function(t){["#displaypwd","#prompt","#displaylist"].forEach(function(e){t===e?$(e).show():$(e).hide()})},$(window).on("load",function(){t=$("#token").val(),console.debug("token",t),o=location.href.replace(/\?.*$/,"")+"/",$("#adddevice").click(addDevice),$("#validatedevice").click(load),load()}),deviceTemplate=function(e,t){return'<div id="list" class="lemonldapp-ng__body-menu-item bg-slate-100 flex flex-col p-8 rounded-xl gap-2 md:gap-4">\n  <h6 class="text-xl font-bold text-center mb-8">Compte "'.concat(e,'"</h6>\n  <button id="remove').concat(t,'" class="cursor-pointer h-[48px] hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600 rounded-xl bg-red-700 text-white p-1 py-2 md:p-2 md:py-3 w-3/3 md:w-3/3">\n     Supprimer\n  </button>\n</div>')}}();